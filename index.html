<!DOCTYPE html>
<html>
<!---
	Scopes:
	P0000.Area.TestScope {objects: [TestObject1, TestObject2, TestObject3, ...]}
	P0000.Area.TestObject.SubObject

-->
  <head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!--script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script-->
    <script type="text/javascript" src="raphael.min.js"></script>
    <script type="text/javascript" src="modelbased-lib.js"></script>
	<script type="text/javascript">
        var paper = 0;
      
      	window.onload = function() {
          paper = new Raphael(document.getElementById("canvas"), 800, 600);

          
          
          /*
          .mouseover(function(e) {
            background.attr('fill', COLOR_HOVER);
          }).mouseout(function(e) {
            background.attr('fill', COLOR_NORMAL);
          })
          */
          sid = QueryString.sid;
          LoadScope(sid);
          Draw();
        }
      
      	function LoadScope(sId) {
          cscope = JSON.parse(localStorage.getItem(sId));
          if(cscope) {
            // Load nodes
            Draw();
          }
          else {
            // Fallback to test scope
            createTestScope();
          }
        }
      
        function SaveScope(sId) {
         localStorage.setItem(sId, JSON.stringify(cscope));

		//...
		//var storedNames = JSON.parse(localStorage.getItem("names")); 
        }
      
    	function Draw() {
          // Creates circle at x = 50, y = 40, with radius 10
          /* var circle = paper.circle(50, 40, 10);
          // Sets the fill attribute of the circle to red (#f00)
          circle.attr("fill", "#f00");
          
          // Sets the stroke attribute of the circle to white
          circle.attr("stroke", "#fff");
          
          circle.attr({
            cursor: 'pointer',
          }).mouseup(function(e) {
            alert("clicked " + e);
          }); */
          for(i = 0; i < cscope.nodes.length; i++) {
            n = cscope.nodes[i];
          	var re = paper.rect( n.x, n.y, 50, 50 );
            //re.attr("nid", n.id);
            n.svgid = re.id;
          	re.attr("fill", "#ff0000");
            re.attr({
            	cursor: 'pointer',
          	}).mouseup(function(e) {
            	//alert("clicked " + document.getElementById(this.id));
                this.x = e.clientX;
                this.y = e.clientY;
                n = GetNode(this.id);
                n.x = e.clientX;
                n.y = e.clientY;
          	});
          }
          
          /*bb1 = circle.getBBox();    
      	  bb2 = re.getBBox();
      	  var newPath = paper.path('M'+bb1.cx+','+bb1.cy+'L'+bb2.cx+','+bb2.cy);
      	  newPath.attr({ stroke: 'blue'})*/

        }
      
      	function RunSimulation() { 
       	  // Nodes sorted by sequence
          // 
          maxItr = 999;
          que = new Array();
          for(i = 0; i < maxIter; i++) {
            que = RunEvents(que);
            if(que == null)
              break;
          }
        }
      
      function RunEvents(que) {
        // Iterate through all objects that have scripts
        // The scope timer is such a script (sets max iterations)
        
      }
      
    </script>
  </head>
  
  <body>
    <div id="canvas">&nbsp;</div>
  </body>
</html>
